var ImaginaryWidget=function(){"use strict";class n{constructor(){this.events={}}on(n,e){return this.events[n]||(this.events[n]=[]),this.events[n].push(e),()=>this.off(n,e)}off(n,e){this.events[n]&&(this.events[n]=this.events[n].filter(n=>n!==e))}emit(n,e){this.events[n]&&this.events[n].forEach(n=>n(e))}clear(){this.events={}}}class e{constructor(n){this.publicKey=n.publicKey,this.apiUrl=n.apiUrl||"http://localhost:8000/api",this.maxFileSize=null,this.allowedMimeTypes=null,this.allowedDomains=null,this.requireCaptcha=!1}async fetchConstraints(){try{const n=await fetch(`${this.apiUrl}/api-keys/constraints/${this.publicKey}`);if(!n.ok)throw new Error("Failed to fetch constraints");const e=await n.json();return this.maxFileSize=e.maxFileSize,this.allowedMimeTypes=e.allowedMimeTypes,this.allowedDomains=e.allowedDomains,this.requireCaptcha=e.requireCaptcha,e}catch(n){throw console.error("Error fetching constraints:",n),n}}validateFile(n){const e=[];return this.maxFileSize&&n.size>this.maxFileSize&&e.push(`File size exceeds maximum allowed size of ${this.formatBytes(this.maxFileSize)}`),this.allowedMimeTypes&&this.allowedMimeTypes.length>0&&(this.allowedMimeTypes.includes(n.type)||e.push(`File type ${n.type} is not allowed`)),{valid:0===e.length,errors:e}}formatBytes(n){if(0===n)return"0 Bytes";const e=Math.floor(Math.log(n)/Math.log(1024));return Math.round(n/Math.pow(1024,e)*100)/100+" "+["Bytes","KB","MB","GB"][e]}}class t extends n{constructor(n){if(super(),!n.publicKey)throw new Error("Public key is required");this.config=new e(n),this.isInitialized=!1,this.currentToken=null,this.tokenExpiryTime=null}async initialize(){if(!this.isInitialized)try{await this.config.fetchConstraints(),this.isInitialized=!0,this.emit("core:initialized",{constraints:{maxFileSize:this.config.maxFileSize,allowedMimeTypes:this.config.allowedMimeTypes,allowedDomains:this.config.allowedDomains,requireCaptcha:this.config.requireCaptcha}})}catch(n){throw this.emit("core:error",{error:n.message}),new Error(`Failed to initialize widget: ${n.message}`)}}async requestUploadToken(){try{if(this.currentToken&&this.tokenExpiryTime&&Date.now()<this.tokenExpiryTime)return this.currentToken;const n=await async function(n,e){try{const t=await fetch(`${n}/upload/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({publicKey:e,origin:window.location.origin})});if(!t.ok)throw new Error("Failed to request upload token");const i=await t.json();return i.token||i.data?.token}catch(n){throw console.error("Token request error:",n),n}}(this.config.apiUrl,this.config.publicKey);return this.currentToken=n,this.tokenExpiryTime=Date.now()+6e5,this.emit("token:received",{token:n}),n}catch(n){throw this.emit("token:error",{error:n.message}),new Error(`Failed to request upload token: ${n.message}`)}}async uploadFile(n,e,t){try{const i=await async function(n,e,t,i){return new Promise((o,r)=>{const s=new FormData;s.append("file",t),s.append("token",e);const a=new XMLHttpRequest;a.upload.addEventListener("progress",n=>{if(n.lengthComputable){const e=n.loaded/n.total*100;i?.(e)}}),a.addEventListener("load",()=>{if(200===a.status||201===a.status)try{const n=JSON.parse(a.responseText),e={file:{name:n.data?.fileName||n.fileName,size:n.data?.size||n.size,type:n.data?.mimeType||n.mimeType},url:n.data?.fileUrl||n.fileUrl,fileId:n.data?.fileId||n.fileId};o(e)}catch(n){r(new Error("Invalid response from server"))}else r(new Error(`Upload failed with status ${a.status}`))}),a.addEventListener("error",()=>{r(new Error("Network error during upload"))}),a.open("POST",`${n}/upload`),a.send(s)})}(this.config.apiUrl,n,e,t);return i}catch(n){throw new Error(`Upload failed: ${n.message}`)}}validateFile(n){return this.config.validateFile(n)}getConstraints(){return{maxFileSize:this.config.maxFileSize,allowedMimeTypes:this.config.allowedMimeTypes,allowedDomains:this.config.allowedDomains,requireCaptcha:this.config.requireCaptcha}}reset(){this.currentToken=null,this.tokenExpiryTime=null,this.clear()}}function i(n,e){var t;return`\n    <div class="file-item" data-file-id="${e}">\n      <div class="file-info">\n        <div class="file-icon">${(t=n.type).startsWith("image/")?"üñºÔ∏è":t.startsWith("video/")?"üé•":t.startsWith("audio/")?"üéµ":t.includes("pdf")?"üìÑ":t.includes("zip")||t.includes("rar")?"üì¶":t.includes("text")?"üìù":"üìÅ"}</div>\n        <div class="file-details">\n          <div class="file-name" title="${n.name}">${n.name}</div>\n          <div class="file-size">${function(n){if(0===n)return"0 Bytes";const e=1024,t=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(n)/Math.log(e));return Math.round(n/Math.pow(e,i)*100)/100+" "+t[i]}(n.size)}</div>\n        </div>\n        <div class="file-actions">\n          <button class="action-btn remove-btn" data-action="remove" data-file-id="${e}">\n            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n              <polyline points="3 6 5 6 21 6"/>\n              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>\n            </svg>\n          </button>\n        </div>\n      </div>\n      <div class="progress-container" style="display: none;">\n        <div class="progress-bar">\n          <div class="progress-fill" style="width: 0%"></div>\n        </div>\n        <div class="progress-text">Uploading... 0%</div>\n      </div>\n      <div class="status-container" style="display: none;"></div>\n    </div>\n  `}class o{constructor(n){this.core=n,this.shadowRoot=null,this.container=null,this.isOpen=!1,this.files=new Map,this.fileIdCounter=0}mount(n){const e=document.createElement("div");e.id="imaginary-widget-host",this.shadowRoot=e.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent="\n  * {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n  }\n\n  :host {\n    --primary: #6366f1;\n    --primary-dark: #4f46e5;\n    --primary-light: #818cf8;\n    --success: #10b981;\n    --error: #ef4444;\n    --warning: #f59e0b;\n    --bg: #ffffff;\n    --bg-secondary: #f9fafb;\n    --border: #e5e7eb;\n    --text: #111827;\n    --text-secondary: #6b7280;\n    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\n  }\n\n  .widget-container {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(0, 0, 0, 0.5);\n    backdrop-filter: blur(4px);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 999999;\n    animation: fadeIn 0.2s ease;\n    opacity: 1;\n    display: none;\n  }\n\n  .widget-container.visible {\n  display:flex;\n    opacity: 1;\n  }\n\n  @keyframes fadeIn {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n\n  .widget-modal {\n    background: var(--bg);\n    border-radius: 16px;\n    box-shadow: var(--shadow-lg);\n    width: 90%;\n    max-width: 500px;\n    max-height: 90vh;\n    overflow: hidden;\n    animation: slideUp 0.3s ease;\n    transform: translateY(20px);\n  }\n\n  .widget-container.visible .widget-modal {\n    transform: translateY(0);\n  }\n\n  @keyframes slideUp {\n    from {\n      transform: translateY(20px);\n      opacity: 0;\n    }\n    to {\n      transform: translateY(0);\n      opacity: 1;\n    }\n  }\n\n  .widget-header {\n    padding: 20px 24px;\n    border-bottom: 1px solid var(--border);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n  }\n\n  .widget-title {\n    font-size: 20px;\n    font-weight: 600;\n    color: var(--text);\n    display: flex;\n    align-items: center;\n    gap: 12px;\n  }\n\n  .widget-logo {\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, var(--primary), var(--primary-light));\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-weight: bold;\n    font-size: 16px;\n  }\n\n  .close-btn {\n    background: transparent;\n    border: none;\n    width: 32px;\n    height: 32px;\n    border-radius: 8px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: var(--text-secondary);\n    transition: all 0.2s;\n  }\n\n  .close-btn:hover {\n    background: var(--bg-secondary);\n    color: var(--text);\n  }\n\n  .widget-body {\n    padding: 24px;\n    max-height: calc(90vh - 180px);\n    overflow-y: auto;\n  }\n\n  .upload-area {\n    border: 2px dashed var(--border);\n    border-radius: 12px;\n    padding: 48px 24px;\n    text-align: center;\n    cursor: pointer;\n    transition: all 0.3s;\n    background: var(--bg-secondary);\n    position: relative;\n    overflow: hidden;\n  }\n\n  .upload-area::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: -100%;\n    width: 100%;\n    height: 100%;\n    background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);\n    transition: left 0.5s;\n  }\n\n  .upload-area:hover::before {\n    left: 100%;\n  }\n\n  .upload-area:hover {\n    border-color: var(--primary);\n    background: rgba(99, 102, 241, 0.05);\n    transform: translateY(-2px);\n  }\n\n  .upload-area.drag-over {\n    border-color: var(--primary);\n    background: rgba(99, 102, 241, 0.1);\n    transform: scale(1.02);\n  }\n\n  .upload-icon {\n    width: 64px;\n    height: 64px;\n    margin: 0 auto 16px;\n    background: linear-gradient(135deg, var(--primary), var(--primary-light));\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 32px;\n  }\n\n  .upload-text {\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--text);\n    margin-bottom: 8px;\n  }\n\n  .upload-hint {\n    font-size: 14px;\n    color: var(--text-secondary);\n    margin-bottom: 16px;\n  }\n\n  .upload-btn {\n    background: var(--primary);\n    color: white;\n    border: none;\n    padding: 12px 24px;\n    border-radius: 8px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s;\n    display: inline-flex;\n    align-items: center;\n    gap: 8px;\n  }\n\n  .upload-btn:hover {\n    background: var(--primary-dark);\n    transform: translateY(-1px);\n    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n  }\n\n  .upload-btn:active {\n    transform: translateY(0);\n  }\n\n  .file-input {\n    display: none;\n  }\n\n  .file-list {\n    margin-top: 24px;\n  }\n\n  .file-item {\n    background: var(--bg-secondary);\n    border: 1px solid var(--border);\n    border-radius: 12px;\n    padding: 16px;\n    margin-bottom: 12px;\n    animation: slideIn 0.3s ease;\n  }\n\n  @keyframes slideIn {\n    from {\n      opacity: 0;\n      transform: translateX(-20px);\n    }\n    to {\n      opacity: 1;\n      transform: translateX(0);\n    }\n  }\n\n  .file-info {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    margin-bottom: 12px;\n  }\n\n  .file-icon {\n    width: 40px;\n    height: 40px;\n    background: var(--primary);\n    border-radius: 8px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    color: white;\n    font-size: 20px;\n    flex-shrink: 0;\n  }\n\n  .file-details {\n    flex: 1;\n    min-width: 0;\n  }\n\n  .file-name {\n    font-size: 14px;\n    font-weight: 600;\n    color: var(--text);\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .file-size {\n    font-size: 12px;\n    color: var(--text-secondary);\n    margin-top: 2px;\n  }\n\n  .file-actions {\n    display: flex;\n    gap: 8px;\n  }\n\n  .action-btn {\n    width: 32px;\n    height: 32px;\n    border: none;\n    border-radius: 6px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s;\n    background: transparent;\n  }\n\n  .action-btn:hover {\n    background: var(--bg);\n  }\n\n  .remove-btn {\n    color: var(--error);\n  }\n\n  .progress-bar {\n    width: 100%;\n    height: 6px;\n    background: var(--bg);\n    border-radius: 3px;\n    overflow: hidden;\n    position: relative;\n  }\n\n  .progress-fill {\n    height: 100%;\n    background: linear-gradient(90deg, var(--primary), var(--primary-light));\n    border-radius: 3px;\n    transition: width 0.3s ease;\n    position: relative;\n    overflow: hidden;\n  }\n\n  .progress-fill::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);\n    animation: shimmer 1.5s infinite;\n  }\n\n  @keyframes shimmer {\n    0% { transform: translateX(-100%); }\n    100% { transform: translateX(100%); }\n  }\n\n  .progress-text {\n    font-size: 12px;\n    color: var(--text-secondary);\n    margin-top: 8px;\n    text-align: center;\n  }\n\n  .status-badge {\n    display: inline-flex;\n    align-items: center;\n    gap: 6px;\n    padding: 4px 12px;\n    border-radius: 12px;\n    font-size: 12px;\n    font-weight: 600;\n  }\n\n  .status-success {\n    background: rgba(16, 185, 129, 0.1);\n    color: var(--success);\n  }\n\n  .status-error {\n    background: rgba(239, 68, 68, 0.1);\n    color: var(--error);\n  }\n\n  .status-uploading {\n    background: rgba(99, 102, 241, 0.1);\n    color: var(--primary);\n  }\n\n  .error-message {\n    background: rgba(239, 68, 68, 0.1);\n    border: 1px solid var(--error);\n    color: var(--error);\n    padding: 12px 16px;\n    border-radius: 8px;\n    font-size: 14px;\n    margin-top: 16px;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n  }\n\n  .constraints-info {\n    background: var(--bg-secondary);\n    border: 1px solid var(--border);\n    border-radius: 8px;\n    padding: 12px 16px;\n    margin-top: 16px;\n    font-size: 12px;\n    color: var(--text-secondary);\n  }\n\n  .constraints-info strong {\n    color: var(--text);\n  }\n\n  .widget-footer {\n    padding: 16px 24px;\n    border-top: 1px solid var(--border);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    gap: 12px;\n  }\n\n  .footer-info {\n    font-size: 12px;\n    color: var(--text-secondary);\n  }\n\n  .footer-actions {\n    display: flex;\n    gap: 12px;\n  }\n\n  .btn-secondary {\n    background: var(--bg-secondary);\n    color: var(--text);\n    border: 1px solid var(--border);\n    padding: 10px 20px;\n    border-radius: 8px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n\n  .btn-secondary:hover {\n    background: var(--bg);\n    border-color: var(--text-secondary);\n  }\n\n  .btn-primary {\n    background: var(--primary);\n    color: white;\n    border: none;\n    padding: 10px 20px;\n    border-radius: 8px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s;\n  }\n\n  .btn-primary:hover {\n    background: var(--primary-dark);\n    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\n  }\n\n  .btn-primary:disabled {\n    background: var(--border);\n    cursor: not-allowed;\n    box-shadow: none;\n  }\n\n  /* Scrollbar styles */\n  ::-webkit-scrollbar {\n    width: 8px;\n  }\n\n  ::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n    border-radius: 4px;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    background: var(--border);\n    border-radius: 4px;\n  }\n\n  ::-webkit-scrollbar-thumb:hover {\n    background: var(--text-secondary);\n  }\n",this.shadowRoot.appendChild(t);const i=document.createElement("div");i.innerHTML='\n    <div class="widget-container">\n      <div class="widget-modal">\n        <div class="widget-header">\n          <div class="widget-title">\n            <div class="widget-logo">IS</div>\n            <span>Upload Files</span>\n          </div>\n          <button class="close-btn" id="closeBtn">\n            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">\n              <path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/>\n            </svg>\n          </button>\n        </div>\n\n        <div class="widget-body">\n          <div class="upload-area" id="uploadArea">\n            <div class="upload-icon">\n              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>\n                <polyline points="17 8 12 3 7 8"/>\n                <line x1="12" y1="3" x2="12" y2="15"/>\n              </svg>\n            </div>\n            <div class="upload-text">Drag & drop files here</div>\n            <div class="upload-hint">or click to browse from your device</div>\n            <button class="upload-btn" id="browseBtn">\n              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>\n                <polyline points="7 10 12 15 17 10"/>\n                <line x1="12" y1="15" x2="12" y2="3"/>\n              </svg>\n              Choose Files\n            </button>\n            <input type="file" class="file-input" id="fileInput" multiple />\n          </div>\n\n          <div id="constraintsInfo"></div>\n          <div id="errorMessage"></div>\n          <div class="file-list" id="fileList"></div>\n        </div>\n\n        <div class="widget-footer">\n          <div class="footer-info">\n            <span id="fileCount">No files selected</span>\n          </div>\n          <div class="footer-actions">\n            <button class="btn-secondary" id="clearBtn">Clear All</button>\n            <button class="btn-primary" id="uploadAllBtn" disabled>Upload All</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  ',this.shadowRoot.appendChild(i.firstElementChild),n?n.appendChild(e):document.body.appendChild(e),this.container=this.shadowRoot.querySelector(".widget-container"),this.setupEventListeners(),this.displayConstraints()}setupEventListeners(){this.shadowRoot.getElementById("closeBtn").addEventListener("click",()=>this.close()),this.container.addEventListener("click",n=>{n.target===this.container&&this.close()});const n=this.shadowRoot.querySelector(".widget-modal");n&&n.addEventListener("click",n=>{n.stopPropagation()});const e=this.shadowRoot.getElementById("browseBtn"),t=this.shadowRoot.getElementById("fileInput");e.addEventListener("click",n=>{n.stopPropagation(),t.click()}),t.addEventListener("change",n=>{this.handleFiles(Array.from(n.target.files)),n.target.value=""});const i=this.shadowRoot.getElementById("uploadArea");i.addEventListener("click",()=>{t.click()}),i.addEventListener("dragover",n=>{n.preventDefault(),i.classList.add("drag-over")}),i.addEventListener("dragleave",()=>{i.classList.remove("drag-over")}),i.addEventListener("drop",n=>{n.preventDefault(),i.classList.remove("drag-over");const e=Array.from(n.dataTransfer.files);this.handleFiles(e)});this.shadowRoot.getElementById("clearBtn").addEventListener("click",()=>this.clearAllFiles());this.shadowRoot.getElementById("uploadAllBtn").addEventListener("click",()=>this.uploadAllFiles());this.shadowRoot.getElementById("fileList").addEventListener("click",n=>{const e=n.target.closest('[data-action="remove"]');if(e){const n=parseInt(e.dataset.fileId);this.removeFile(n)}})}handleFiles(n){this.shadowRoot.getElementById("errorMessage").innerHTML="",n.forEach(n=>{const e=this.core.config.validateFile(n);if(!e.valid)return void this.showError(e.errors.join(", "));const t=this.fileIdCounter++;this.files.set(t,{file:n,status:"pending",progress:0}),this.renderFileItem(t,n)}),this.updateUI()}renderFileItem(n,e){const t=this.shadowRoot.getElementById("fileList"),o=i(e,n);t.insertAdjacentHTML("beforeend",o)}removeFile(n){this.files.delete(n);const e=this.shadowRoot.querySelector(`[data-file-id="${n}"]`);e&&(e.style.animation="slideOut 0.3s ease",setTimeout(()=>e.remove(),300)),this.updateUI()}clearAllFiles(){this.files.clear();this.shadowRoot.getElementById("fileList").innerHTML="",this.updateUI(),this.clearError()}async uploadAllFiles(){const n=this.shadowRoot.getElementById("uploadAllBtn");n.disabled=!0,n.textContent="Uploading...";for(const[n,e]of this.files.entries())"pending"===e.status&&await this.uploadFile(n,e.file);n.disabled=!1,n.textContent="Upload All",this.core.emit("upload:complete",{total:this.files.size,successful:Array.from(this.files.values()).filter(n=>"success"===n.status).length,failed:Array.from(this.files.values()).filter(n=>"error"===n.status).length})}async uploadFile(n,e){const t=this.files.get(n);t.status="uploading";const i=this.shadowRoot.querySelector(`[data-file-id="${n}"]`),o=i.querySelector(".progress-container"),r=i.querySelector(".progress-fill"),s=i.querySelector(".progress-text"),a=i.querySelector(".status-container");o.style.display="block",this.core.emit("upload:start",{fileId:n,file:e});try{const i=await this.core.requestUploadToken(),l=await this.core.uploadFile(i,e,i=>{t.progress=i,r.style.width=`${i}%`,s.textContent=`Uploading... ${Math.round(i)}%`,this.core.emit("upload:progress",{fileId:n,file:e,progress:i})});t.status="success",t.url=l.url,o.style.display="none",a.style.display="block",a.innerHTML='\n        <div class="status-badge status-success">\n          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">\n            <polyline points="20 6 9 17 4 12"/>\n          </svg>\n          Uploaded\n        </div>\n      ',this.core.emit("upload:success",{fileId:n,file:e,url:l.url})}catch(i){t.status="error",t.error=i.message,o.style.display="none",a.style.display="block",a.innerHTML='\n        <div class="status-badge status-error">\n          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">\n            <circle cx="12" cy="12" r="10"/>\n            <line x1="15" y1="9" x2="9" y2="15"/>\n            <line x1="9" y1="9" x2="15" y2="15"/>\n          </svg>\n          Failed\n        </div>\n      ',this.core.emit("upload:error",{fileId:n,file:e,error:i.message}),this.showError(`Failed to upload ${e.name}: ${i.message}`)}}updateUI(){const n=this.shadowRoot.getElementById("fileCount"),e=this.shadowRoot.getElementById("uploadAllBtn"),t=this.shadowRoot.getElementById("clearBtn"),i=this.files.size,o=Array.from(this.files.values()).filter(n=>"pending"===n.status).length;0===i?(n.textContent="No files selected",e.disabled=!0,t.disabled=!0):(n.textContent=`${i} file${1!==i?"s":""} selected`,e.disabled=0===o,t.disabled=!1)}displayConstraints(){const n=this.shadowRoot.getElementById("constraintsInfo"),e=this.core.config;if(e.maxFileSize||e.allowedMimeTypes){let t='<div class="constraints-info">';t+="<strong>Upload limits:</strong> ";const i=[];if(e.maxFileSize&&i.push(`Max size: ${e.formatBytes(e.maxFileSize)}`),e.allowedMimeTypes&&e.allowedMimeTypes.length>0){const n=e.allowedMimeTypes.map(n=>n.split("/")[1]).join(", ");i.push(`Allowed types: ${n}`)}t+=i.join(" ‚Ä¢ "),t+="</div>",n.innerHTML=t}}showError(n){this.shadowRoot.getElementById("errorMessage").innerHTML=`\n      <div class="error-message">\n        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n          <circle cx="12" cy="12" r="10"/>\n          <line x1="12" y1="8" x2="12" y2="12"/>\n          <line x1="12" y1="16" x2="12.01" y2="16"/>\n        </svg>\n        ${n}\n      </div>\n    `}clearError(){this.shadowRoot.getElementById("errorMessage").innerHTML=""}open(){this.isOpen||(this.isOpen=!0,this.container.style.display="flex",this.container.offsetHeight,setTimeout(()=>{this.container.classList.add("visible")},10),document.body.style.overflow="hidden",this.core.emit("widget:open"),console.log("üî• Widget opened successfully"))}close(){this.isOpen&&(console.log("üö™ Closing widget"),this.isOpen=!1,this.container.classList.remove("visible"),setTimeout(()=>{this.container.style.display="none",document.body.style.overflow=""},300),this.core.emit("widget:close"))}destroy(){const n=this.shadowRoot?.host;n&&n.remove(),this.files.clear(),this.core.emit("widget:destroy")}}class r{constructor(){this.core=null,this.ui=null,this.isInitialized=!1}async init(n){if(this.isInitialized)return console.warn("Widget is already initialized"),this;try{return this.core=new t(n),await this.core.initialize(),this.ui=new o(this.core),this.ui.mount(n.mount||null),this.isInitialized=!0,n.onSuccess&&this.core.on("upload:success",n.onSuccess),n.onError&&this.core.on("upload:error",n.onError),n.onProgress&&this.core.on("upload:progress",n.onProgress),n.onComplete&&this.core.on("upload:complete",n.onComplete),console.log("‚úÖ ImaginaryWidget initialized successfully"),this}catch(n){throw console.error("‚ùå Failed to initialize ImaginaryWidget:",n),n}}open(){this.isInitialized?this.ui.open():console.error("Widget is not initialized. Call init() first.")}close(){this.isInitialized&&this.ui.close()}on(n,e){if(this.isInitialized)return this.core.on(n,e);console.error("Widget is not initialized. Call init() first.")}off(n,e){this.isInitialized&&this.core.off(n,e)}destroy(){this.isInitialized&&(this.ui.destroy(),this.core.reset(),this.isInitialized=!1,console.log("üóëÔ∏è ImaginaryWidget destroyed"))}getConstraints(){return this.isInitialized?this.core.getConstraints():(console.error("Widget is not initialized. Call init() first."),null)}}return"undefined"!=typeof window&&(window.ImaginaryWidget=r),r}();
//# sourceMappingURL=widget.js.map
