{"version":3,"file":"widget.js","sources":["../src/core/events.js","../src/core/config.js","../src/core/WidgetCore.js","../src/api/requestToken.js","../src/api/uploadFile.js","../src/ui/templates.js","../src/ui/WidgetUI.js","../src/ui/styles.js","../src/index.js"],"sourcesContent":["export class EventEmitter {\r\n  constructor() {\r\n    this.events = {};\r\n  }\r\n\r\n  on(event, callback) {\r\n    if (!this.events[event]) {\r\n      this.events[event] = [];\r\n    }\r\n    this.events[event].push(callback);\r\n    return () => this.off(event, callback);\r\n  }\r\n\r\n  off(event, callback) {\r\n    if (!this.events[event]) return;\r\n    this.events[event] = this.events[event].filter(cb => cb !== callback);\r\n  }\r\n\r\n  emit(event, data) {\r\n    if (!this.events[event]) return;\r\n    this.events[event].forEach(callback => callback(data));\r\n  }\r\n\r\n  clear() {\r\n    this.events = {};\r\n  }\r\n}","export class Config {\n  constructor(options) {\n    this.publicKey = options.publicKey;\n    this.apiUrl = options.apiUrl || 'http://localhost:8000/api'; // Your backend URL\n    this.maxFileSize = null; // Will be fetched from server\n    this.allowedMimeTypes = null;\n    this.allowedDomains = null;\n    this.requireCaptcha = false;\n  }\n\n  async fetchConstraints() {\n    try {\n      const response = await fetch(`${this.apiUrl}/api-keys/constraints/${this.publicKey}`);\n      if (!response.ok) throw new Error('Failed to fetch constraints');\n      \n      const data = await response.json();\n      this.maxFileSize = data.maxFileSize;\n      this.allowedMimeTypes = data.allowedMimeTypes;\n      this.allowedDomains = data.allowedDomains;\n      this.requireCaptcha = data.requireCaptcha;\n      \n      return data;\n    } catch (error) {\n      console.error('Error fetching constraints:', error);\n      throw error;\n    }\n  }\n\n  validateFile(file) {\n    const errors = [];\n\n    // Check file size\n    if (this.maxFileSize && file.size > this.maxFileSize) {\n      errors.push(`File size exceeds maximum allowed size of ${this.formatBytes(this.maxFileSize)}`);\n    }\n\n    // Check MIME type\n    if (this.allowedMimeTypes && this.allowedMimeTypes.length > 0) {\n      if (!this.allowedMimeTypes.includes(file.type)) {\n        errors.push(`File type ${file.type} is not allowed`);\n      }\n    }\n\n    return {\n      valid: errors.length === 0,\n      errors\n    };\n  }\n\n  formatBytes(bytes) {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  }\n}","import { EventEmitter } from './events.js';\r\nimport { Config } from './config.js';\r\nimport { requestUploadToken } from '../api/requestToken.js';\r\nimport { uploadFile } from '../api/uploadFile.js';\r\n\r\nexport class WidgetCore extends EventEmitter {\r\n  constructor(options) {\r\n    super();\r\n    \r\n    if (!options.publicKey) {\r\n      throw new Error('Public key is required');\r\n    }\r\n\r\n    this.config = new Config(options);\r\n    this.isInitialized = false;\r\n    this.currentToken = null;\r\n    this.tokenExpiryTime = null;\r\n  }\r\n\r\n  async initialize() {\r\n    if (this.isInitialized) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Fetch constraints from server\r\n      await this.config.fetchConstraints();\r\n      this.isInitialized = true;\r\n      this.emit('core:initialized', {\r\n        constraints: {\r\n          maxFileSize: this.config.maxFileSize,\r\n          allowedMimeTypes: this.config.allowedMimeTypes,\r\n          allowedDomains: this.config.allowedDomains,\r\n          requireCaptcha: this.config.requireCaptcha\r\n        }\r\n      });\r\n    } catch (error) {\r\n      this.emit('core:error', { error: error.message });\r\n      throw new Error(`Failed to initialize widget: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  async requestUploadToken() {\r\n    try {\r\n      // Check if we have a valid token\r\n      if (this.currentToken && this.tokenExpiryTime && Date.now() < this.tokenExpiryTime) {\r\n        return this.currentToken;\r\n      }\r\n\r\n      // Request new token\r\n      const token = await requestUploadToken(this.config.apiUrl, this.config.publicKey);\r\n      \r\n      // Store token with expiry (assume 10 minutes validity)\r\n      this.currentToken = token;\r\n      this.tokenExpiryTime = Date.now() + (10 * 60 * 1000);\r\n\r\n      this.emit('token:received', { token });\r\n      return token;\r\n\r\n    } catch (error) {\r\n      this.emit('token:error', { error: error.message });\r\n      throw new Error(`Failed to request upload token: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  async uploadFile(token, file, onProgress) {\r\n    try {\r\n      const result = await uploadFile(\r\n        this.config.apiUrl,\r\n        token,\r\n        file,\r\n        onProgress\r\n      );\r\n\r\n      return result;\r\n\r\n    } catch (error) {\r\n      throw new Error(`Upload failed: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  validateFile(file) {\r\n    return this.config.validateFile(file);\r\n  }\r\n\r\n  getConstraints() {\r\n    return {\r\n      maxFileSize: this.config.maxFileSize,\r\n      allowedMimeTypes: this.config.allowedMimeTypes,\r\n      allowedDomains: this.config.allowedDomains,\r\n      requireCaptcha: this.config.requireCaptcha\r\n    };\r\n  }\r\n\r\n  reset() {\r\n    this.currentToken = null;\r\n    this.tokenExpiryTime = null;\r\n    this.clear(); // Clear all event listeners\r\n  }\r\n}","export async function requestUploadToken(apiUrl, publicKey) {\n  try {\n    const response = await fetch(`${apiUrl}/upload/token`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        publicKey,\n        origin: window.location.origin\n      })\n    });\n\n    if (!response.ok) {\n      throw new Error('Failed to request upload token');\n    }\n\n    const data = await response.json();\n    // Handle both direct response and wrapped response formats\n    return data.token || data.data?.token;\n  } catch (error) {\n    console.error('Token request error:', error);\n    throw error;\n  }\n}","export async function uploadFile(apiUrl, token, file, onProgress) {\n  return new Promise((resolve, reject) => {\n    const formData = new FormData();\n    formData.append('file', file);\n    formData.append('token', token);\n\n    const xhr = new XMLHttpRequest();\n\n    xhr.upload.addEventListener('progress', (e) => {\n      if (e.lengthComputable) {\n        const percentComplete = (e.loaded / e.total) * 100;\n        onProgress?.(percentComplete);\n      }\n    });\n\n    xhr.addEventListener('load', () => {\n      if (xhr.status === 200 || xhr.status === 201) {\n        try {\n          const response = JSON.parse(xhr.responseText);\n          // Transform backend response to widget format\n          const transformedResponse = {\n            file: {\n              name: response.data?.fileName || response.fileName,\n              size: response.data?.size || response.size,\n              type: response.data?.mimeType || response.mimeType\n            },\n            url: response.data?.fileUrl || response.fileUrl,\n            fileId: response.data?.fileId || response.fileId\n          };\n          resolve(transformedResponse);\n        } catch (error) {\n          reject(new Error('Invalid response from server'));\n        }\n      } else {\n        reject(new Error(`Upload failed with status ${xhr.status}`));\n      }\n    });\n\n    xhr.addEventListener('error', () => {\n      reject(new Error('Network error during upload'));\n    });\n\n    xhr.open('POST', `${apiUrl}/upload`);\n    xhr.send(formData);\n  });\n}","export function createMainTemplate() {\r\n  return `\r\n    <div class=\"widget-container\">\r\n      <div class=\"widget-modal\">\r\n        <div class=\"widget-header\">\r\n          <div class=\"widget-title\">\r\n            <div class=\"widget-logo\">IS</div>\r\n            <span>Upload Files</span>\r\n          </div>\r\n          <button class=\"close-btn\" id=\"closeBtn\">\r\n            <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\r\n              <path d=\"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div class=\"widget-body\">\r\n          <div class=\"upload-area\" id=\"uploadArea\">\r\n            <div class=\"upload-icon\">\r\n              <svg width=\"32\" height=\"32\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n                <polyline points=\"17 8 12 3 7 8\"/>\r\n                <line x1=\"12\" y1=\"3\" x2=\"12\" y2=\"15\"/>\r\n              </svg>\r\n            </div>\r\n            <div class=\"upload-text\">Drag & drop files here</div>\r\n            <div class=\"upload-hint\">or click to browse from your device</div>\r\n            <button class=\"upload-btn\" id=\"browseBtn\">\r\n              <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                <path d=\"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\"/>\r\n                <polyline points=\"7 10 12 15 17 10\"/>\r\n                <line x1=\"12\" y1=\"15\" x2=\"12\" y2=\"3\"/>\r\n              </svg>\r\n              Choose Files\r\n            </button>\r\n            <input type=\"file\" class=\"file-input\" id=\"fileInput\" multiple />\r\n          </div>\r\n\r\n          <div id=\"constraintsInfo\"></div>\r\n          <div id=\"errorMessage\"></div>\r\n          <div class=\"file-list\" id=\"fileList\"></div>\r\n        </div>\r\n\r\n        <div class=\"widget-footer\">\r\n          <div class=\"footer-info\">\r\n            <span id=\"fileCount\">No files selected</span>\r\n          </div>\r\n          <div class=\"footer-actions\">\r\n            <button class=\"btn-secondary\" id=\"clearBtn\">Clear All</button>\r\n            <button class=\"btn-primary\" id=\"uploadAllBtn\" disabled>Upload All</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nexport function createFileItemTemplate(file, id) {\r\n  const icon = getFileIcon(file.type);\r\n  return `\r\n    <div class=\"file-item\" data-file-id=\"${id}\">\r\n      <div class=\"file-info\">\r\n        <div class=\"file-icon\">${icon}</div>\r\n        <div class=\"file-details\">\r\n          <div class=\"file-name\" title=\"${file.name}\">${file.name}</div>\r\n          <div class=\"file-size\">${formatBytes(file.size)}</div>\r\n        </div>\r\n        <div class=\"file-actions\">\r\n          <button class=\"action-btn remove-btn\" data-action=\"remove\" data-file-id=\"${id}\">\r\n            <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n              <polyline points=\"3 6 5 6 21 6\"/>\r\n              <path d=\"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2\"/>\r\n            </svg>\r\n          </button>\r\n        </div>\r\n      </div>\r\n      <div class=\"progress-container\" style=\"display: none;\">\r\n        <div class=\"progress-bar\">\r\n          <div class=\"progress-fill\" style=\"width: 0%\"></div>\r\n        </div>\r\n        <div class=\"progress-text\">Uploading... 0%</div>\r\n      </div>\r\n      <div class=\"status-container\" style=\"display: none;\"></div>\r\n    </div>\r\n  `;\r\n}\r\n\r\nfunction getFileIcon(mimeType) {\r\n  if (mimeType.startsWith('image/')) return 'üñºÔ∏è';\r\n  if (mimeType.startsWith('video/')) return 'üé•';\r\n  if (mimeType.startsWith('audio/')) return 'üéµ';\r\n  if (mimeType.includes('pdf')) return 'üìÑ';\r\n  if (mimeType.includes('zip') || mimeType.includes('rar')) return 'üì¶';\r\n  if (mimeType.includes('text')) return 'üìù';\r\n  return 'üìÅ';\r\n}\r\n\r\nfunction formatBytes(bytes) {\r\n  if (bytes === 0) return '0 Bytes';\r\n  const k = 1024;\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\r\n}","import { styles } from './styles.js';\r\nimport { createMainTemplate, createFileItemTemplate } from './templates.js';\r\n\r\nexport class WidgetUI {\r\n  constructor(core) {\r\n    this.core = core;\r\n    this.shadowRoot = null;\r\n    this.container = null;\r\n    this.isOpen = false;\r\n    this.files = new Map(); // Map<fileId, { file, status, progress }>\r\n    this.fileIdCounter = 0;\r\n  }\r\n\r\n  mount(targetElement) {\r\n    // Create shadow DOM for style isolation\r\n    const host = document.createElement('div');\r\n    host.id = 'imaginary-widget-host';\r\n    this.shadowRoot = host.attachShadow({ mode: 'open' });\r\n\r\n    // Add styles\r\n    const styleSheet = document.createElement('style');\r\n    styleSheet.textContent = styles;\r\n    this.shadowRoot.appendChild(styleSheet);\r\n\r\n    // Add HTML template\r\n    const template = document.createElement('div');\r\n    template.innerHTML = createMainTemplate();\r\n    this.shadowRoot.appendChild(template.firstElementChild);\r\n\r\n    // Append to target or body\r\n    if (targetElement) {\r\n      targetElement.appendChild(host);\r\n    } else {\r\n      document.body.appendChild(host);\r\n    }\r\n\r\n    this.container = this.shadowRoot.querySelector('.widget-container');\r\n    this.setupEventListeners();\r\n    this.displayConstraints();\r\n  }\r\n\r\n  setupEventListeners() {\r\n    // Close button\r\n    const closeBtn = this.shadowRoot.getElementById('closeBtn');\r\n    closeBtn.addEventListener('click', () => this.close());\r\n\r\n    // Click outside to close\r\n    this.container.addEventListener('click', (e) => {\r\n      if (e.target === this.container) {\r\n        this.close();\r\n      }\r\n    });\r\n\r\n    // Browse button\r\n    const browseBtn = this.shadowRoot.getElementById('browseBtn');\r\n    const fileInput = this.shadowRoot.getElementById('fileInput');\r\n    browseBtn.addEventListener('click', (e) => {\r\n      e.stopPropagation();\r\n      fileInput.click();\r\n    });\r\n\r\n    // File input change\r\n    fileInput.addEventListener('change', (e) => {\r\n      this.handleFiles(Array.from(e.target.files));\r\n      e.target.value = ''; // Reset input\r\n    });\r\n\r\n    // Drag and drop\r\n    const uploadArea = this.shadowRoot.getElementById('uploadArea');\r\n    \r\n    uploadArea.addEventListener('click', () => {\r\n      fileInput.click();\r\n    });\r\n\r\n    uploadArea.addEventListener('dragover', (e) => {\r\n      e.preventDefault();\r\n      uploadArea.classList.add('drag-over');\r\n    });\r\n\r\n    uploadArea.addEventListener('dragleave', () => {\r\n      uploadArea.classList.remove('drag-over');\r\n    });\r\n\r\n    uploadArea.addEventListener('drop', (e) => {\r\n      e.preventDefault();\r\n      uploadArea.classList.remove('drag-over');\r\n      \r\n      const files = Array.from(e.dataTransfer.files);\r\n      this.handleFiles(files);\r\n    });\r\n\r\n    // Clear all button\r\n    const clearBtn = this.shadowRoot.getElementById('clearBtn');\r\n    clearBtn.addEventListener('click', () => this.clearAllFiles());\r\n\r\n    // Upload all button\r\n    const uploadAllBtn = this.shadowRoot.getElementById('uploadAllBtn');\r\n    uploadAllBtn.addEventListener('click', () => this.uploadAllFiles());\r\n\r\n    // File list delegation for remove buttons\r\n    const fileList = this.shadowRoot.getElementById('fileList');\r\n    fileList.addEventListener('click', (e) => {\r\n      const removeBtn = e.target.closest('[data-action=\"remove\"]');\r\n      if (removeBtn) {\r\n        const fileId = parseInt(removeBtn.dataset.fileId);\r\n        this.removeFile(fileId);\r\n      }\r\n    });\r\n  }\r\n\r\n  handleFiles(files) {\r\n    const errorMessage = this.shadowRoot.getElementById('errorMessage');\r\n    errorMessage.innerHTML = '';\r\n\r\n    files.forEach(file => {\r\n      // Validate file\r\n      const validation = this.core.config.validateFile(file);\r\n      \r\n      if (!validation.valid) {\r\n        this.showError(validation.errors.join(', '));\r\n        return;\r\n      }\r\n\r\n      // Add file to list\r\n      const fileId = this.fileIdCounter++;\r\n      this.files.set(fileId, {\r\n        file,\r\n        status: 'pending',\r\n        progress: 0\r\n      });\r\n\r\n      this.renderFileItem(fileId, file);\r\n    });\r\n\r\n    this.updateUI();\r\n  }\r\n\r\n  renderFileItem(fileId, file) {\r\n    const fileList = this.shadowRoot.getElementById('fileList');\r\n    const fileItemHTML = createFileItemTemplate(file, fileId);\r\n    fileList.insertAdjacentHTML('beforeend', fileItemHTML);\r\n  }\r\n\r\n  removeFile(fileId) {\r\n    this.files.delete(fileId);\r\n    const fileItem = this.shadowRoot.querySelector(`[data-file-id=\"${fileId}\"]`);\r\n    if (fileItem) {\r\n      fileItem.style.animation = 'slideOut 0.3s ease';\r\n      setTimeout(() => fileItem.remove(), 300);\r\n    }\r\n    this.updateUI();\r\n  }\r\n\r\n  clearAllFiles() {\r\n    this.files.clear();\r\n    const fileList = this.shadowRoot.getElementById('fileList');\r\n    fileList.innerHTML = '';\r\n    this.updateUI();\r\n    this.clearError();\r\n  }\r\n\r\n  async uploadAllFiles() {\r\n    const uploadAllBtn = this.shadowRoot.getElementById('uploadAllBtn');\r\n    uploadAllBtn.disabled = true;\r\n    uploadAllBtn.textContent = 'Uploading...';\r\n\r\n    for (const [fileId, fileData] of this.files.entries()) {\r\n      if (fileData.status === 'pending') {\r\n        await this.uploadFile(fileId, fileData.file);\r\n      }\r\n    }\r\n\r\n    uploadAllBtn.disabled = false;\r\n    uploadAllBtn.textContent = 'Upload All';\r\n    \r\n    // Emit complete event\r\n    this.core.emit('upload:complete', {\r\n      total: this.files.size,\r\n      successful: Array.from(this.files.values()).filter(f => f.status === 'success').length,\r\n      failed: Array.from(this.files.values()).filter(f => f.status === 'error').length\r\n    });\r\n  }\r\n\r\n  async uploadFile(fileId, file) {\r\n    const fileData = this.files.get(fileId);\r\n    fileData.status = 'uploading';\r\n    \r\n    const fileItem = this.shadowRoot.querySelector(`[data-file-id=\"${fileId}\"]`);\r\n    const progressContainer = fileItem.querySelector('.progress-container');\r\n    const progressFill = fileItem.querySelector('.progress-fill');\r\n    const progressText = fileItem.querySelector('.progress-text');\r\n    const statusContainer = fileItem.querySelector('.status-container');\r\n\r\n    progressContainer.style.display = 'block';\r\n\r\n    this.core.emit('upload:start', { fileId, file });\r\n\r\n    try {\r\n      // Request upload token\r\n      const token = await this.core.requestUploadToken();\r\n\r\n      // Upload file with progress\r\n      const result = await this.core.uploadFile(token, file, (progress) => {\r\n        fileData.progress = progress;\r\n        progressFill.style.width = `${progress}%`;\r\n        progressText.textContent = `Uploading... ${Math.round(progress)}%`;\r\n        \r\n        this.core.emit('upload:progress', { fileId, file, progress });\r\n      });\r\n\r\n      // Success\r\n      fileData.status = 'success';\r\n      fileData.url = result.url;\r\n      \r\n      progressContainer.style.display = 'none';\r\n      statusContainer.style.display = 'block';\r\n      statusContainer.innerHTML = `\r\n        <div class=\"status-badge status-success\">\r\n          <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\">\r\n            <polyline points=\"20 6 9 17 4 12\"/>\r\n          </svg>\r\n          Uploaded\r\n        </div>\r\n      `;\r\n\r\n      this.core.emit('upload:success', { fileId, file, url: result.url });\r\n\r\n    } catch (error) {\r\n      // Error\r\n      fileData.status = 'error';\r\n      fileData.error = error.message;\r\n      \r\n      progressContainer.style.display = 'none';\r\n      statusContainer.style.display = 'block';\r\n      statusContainer.innerHTML = `\r\n        <div class=\"status-badge status-error\">\r\n          <svg width=\"12\" height=\"12\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"3\">\r\n            <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n            <line x1=\"15\" y1=\"9\" x2=\"9\" y2=\"15\"/>\r\n            <line x1=\"9\" y1=\"9\" x2=\"15\" y2=\"15\"/>\r\n          </svg>\r\n          Failed\r\n        </div>\r\n      `;\r\n\r\n      this.core.emit('upload:error', { fileId, file, error: error.message });\r\n      this.showError(`Failed to upload ${file.name}: ${error.message}`);\r\n    }\r\n  }\r\n\r\n  updateUI() {\r\n    const fileCount = this.shadowRoot.getElementById('fileCount');\r\n    const uploadAllBtn = this.shadowRoot.getElementById('uploadAllBtn');\r\n    const clearBtn = this.shadowRoot.getElementById('clearBtn');\r\n\r\n    const totalFiles = this.files.size;\r\n    const pendingFiles = Array.from(this.files.values()).filter(f => f.status === 'pending').length;\r\n\r\n    if (totalFiles === 0) {\r\n      fileCount.textContent = 'No files selected';\r\n      uploadAllBtn.disabled = true;\r\n      clearBtn.disabled = true;\r\n    } else {\r\n      fileCount.textContent = `${totalFiles} file${totalFiles !== 1 ? 's' : ''} selected`;\r\n      uploadAllBtn.disabled = pendingFiles === 0;\r\n      clearBtn.disabled = false;\r\n    }\r\n  }\r\n\r\n  displayConstraints() {\r\n    const constraintsInfo = this.shadowRoot.getElementById('constraintsInfo');\r\n    const config = this.core.config;\r\n\r\n    if (config.maxFileSize || config.allowedMimeTypes) {\r\n      let html = '<div class=\"constraints-info\">';\r\n      html += '<strong>Upload limits:</strong> ';\r\n      \r\n      const limits = [];\r\n      if (config.maxFileSize) {\r\n        limits.push(`Max size: ${config.formatBytes(config.maxFileSize)}`);\r\n      }\r\n      if (config.allowedMimeTypes && config.allowedMimeTypes.length > 0) {\r\n        const types = config.allowedMimeTypes.map(t => t.split('/')[1]).join(', ');\r\n        limits.push(`Allowed types: ${types}`);\r\n      }\r\n      \r\n      html += limits.join(' ‚Ä¢ ');\r\n      html += '</div>';\r\n      \r\n      constraintsInfo.innerHTML = html;\r\n    }\r\n  }\r\n\r\n  showError(message) {\r\n    const errorMessage = this.shadowRoot.getElementById('errorMessage');\r\n    errorMessage.innerHTML = `\r\n      <div class=\"error-message\">\r\n        <svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\">\r\n          <circle cx=\"12\" cy=\"12\" r=\"10\"/>\r\n          <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\"/>\r\n          <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\"/>\r\n        </svg>\r\n        ${message}\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  clearError() {\r\n    const errorMessage = this.shadowRoot.getElementById('errorMessage');\r\n    errorMessage.innerHTML = '';\r\n  }\r\n\r\n  open() {\r\n    if (!this.isOpen) {\r\n      this.isOpen = true;\r\n      this.container.style.display = 'flex';\r\n      // Trigger reflow\r\n      this.container.offsetHeight;\r\n      this.container.classList.add('visible');\r\n      document.body.style.overflow = 'hidden';\r\n      this.core.emit('widget:open');\r\n    }\r\n  }\r\n\r\n  close() {\r\n    if (this.isOpen) {\r\n      this.isOpen = false;\r\n      this.container.classList.remove('visible');\r\n      setTimeout(() => {\r\n        this.container.style.display = 'none';\r\n        document.body.style.overflow = '';\r\n      }, 200);\r\n      this.core.emit('widget:close');\r\n    }\r\n  }\r\n\r\n  destroy() {\r\n    const host = this.shadowRoot?.host;\r\n    if (host) {\r\n      host.remove();\r\n    }\r\n    this.files.clear();\r\n    this.core.emit('widget:destroy');\r\n  }\r\n}","export const styles = `\r\n  * {\r\n    margin: 0;\r\n    padding: 0;\r\n    box-sizing: border-box;\r\n  }\r\n\r\n  :host {\r\n    --primary: #6366f1;\r\n    --primary-dark: #4f46e5;\r\n    --primary-light: #818cf8;\r\n    --success: #10b981;\r\n    --error: #ef4444;\r\n    --warning: #f59e0b;\r\n    --bg: #ffffff;\r\n    --bg-secondary: #f9fafb;\r\n    --border: #e5e7eb;\r\n    --text: #111827;\r\n    --text-secondary: #6b7280;\r\n    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\r\n    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);\r\n  }\r\n\r\n  .widget-container {\r\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    backdrop-filter: blur(4px);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 999999;\r\n    animation: fadeIn 0.2s ease;\r\n    opacity: 0;\r\n  }\r\n\r\n  .widget-container.visible {\r\n    opacity: 1;\r\n  }\r\n\r\n  @keyframes fadeIn {\r\n    from {\r\n      opacity: 0;\r\n    }\r\n    to {\r\n      opacity: 1;\r\n    }\r\n  }\r\n\r\n  .widget-modal {\r\n    background: var(--bg);\r\n    border-radius: 16px;\r\n    box-shadow: var(--shadow-lg);\r\n    width: 90%;\r\n    max-width: 500px;\r\n    max-height: 90vh;\r\n    overflow: hidden;\r\n    animation: slideUp 0.3s ease;\r\n    transform: translateY(20px);\r\n  }\r\n\r\n  .widget-container.visible .widget-modal {\r\n    transform: translateY(0);\r\n  }\r\n\r\n  @keyframes slideUp {\r\n    from {\r\n      transform: translateY(20px);\r\n      opacity: 0;\r\n    }\r\n    to {\r\n      transform: translateY(0);\r\n      opacity: 1;\r\n    }\r\n  }\r\n\r\n  .widget-header {\r\n    padding: 20px 24px;\r\n    border-bottom: 1px solid var(--border);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n  }\r\n\r\n  .widget-title {\r\n    font-size: 20px;\r\n    font-weight: 600;\r\n    color: var(--text);\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n  }\r\n\r\n  .widget-logo {\r\n    width: 32px;\r\n    height: 32px;\r\n    background: linear-gradient(135deg, var(--primary), var(--primary-light));\r\n    border-radius: 8px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    color: white;\r\n    font-weight: bold;\r\n    font-size: 16px;\r\n  }\r\n\r\n  .close-btn {\r\n    background: transparent;\r\n    border: none;\r\n    width: 32px;\r\n    height: 32px;\r\n    border-radius: 8px;\r\n    cursor: pointer;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    color: var(--text-secondary);\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .close-btn:hover {\r\n    background: var(--bg-secondary);\r\n    color: var(--text);\r\n  }\r\n\r\n  .widget-body {\r\n    padding: 24px;\r\n    max-height: calc(90vh - 180px);\r\n    overflow-y: auto;\r\n  }\r\n\r\n  .upload-area {\r\n    border: 2px dashed var(--border);\r\n    border-radius: 12px;\r\n    padding: 48px 24px;\r\n    text-align: center;\r\n    cursor: pointer;\r\n    transition: all 0.3s;\r\n    background: var(--bg-secondary);\r\n    position: relative;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .upload-area::before {\r\n    content: '';\r\n    position: absolute;\r\n    top: 0;\r\n    left: -100%;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);\r\n    transition: left 0.5s;\r\n  }\r\n\r\n  .upload-area:hover::before {\r\n    left: 100%;\r\n  }\r\n\r\n  .upload-area:hover {\r\n    border-color: var(--primary);\r\n    background: rgba(99, 102, 241, 0.05);\r\n    transform: translateY(-2px);\r\n  }\r\n\r\n  .upload-area.drag-over {\r\n    border-color: var(--primary);\r\n    background: rgba(99, 102, 241, 0.1);\r\n    transform: scale(1.02);\r\n  }\r\n\r\n  .upload-icon {\r\n    width: 64px;\r\n    height: 64px;\r\n    margin: 0 auto 16px;\r\n    background: linear-gradient(135deg, var(--primary), var(--primary-light));\r\n    border-radius: 50%;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    color: white;\r\n    font-size: 32px;\r\n  }\r\n\r\n  .upload-text {\r\n    font-size: 18px;\r\n    font-weight: 600;\r\n    color: var(--text);\r\n    margin-bottom: 8px;\r\n  }\r\n\r\n  .upload-hint {\r\n    font-size: 14px;\r\n    color: var(--text-secondary);\r\n    margin-bottom: 16px;\r\n  }\r\n\r\n  .upload-btn {\r\n    background: var(--primary);\r\n    color: white;\r\n    border: none;\r\n    padding: 12px 24px;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n\r\n  .upload-btn:hover {\r\n    background: var(--primary-dark);\r\n    transform: translateY(-1px);\r\n    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\r\n  }\r\n\r\n  .upload-btn:active {\r\n    transform: translateY(0);\r\n  }\r\n\r\n  .file-input {\r\n    display: none;\r\n  }\r\n\r\n  .file-list {\r\n    margin-top: 24px;\r\n  }\r\n\r\n  .file-item {\r\n    background: var(--bg-secondary);\r\n    border: 1px solid var(--border);\r\n    border-radius: 12px;\r\n    padding: 16px;\r\n    margin-bottom: 12px;\r\n    animation: slideIn 0.3s ease;\r\n  }\r\n\r\n  @keyframes slideIn {\r\n    from {\r\n      opacity: 0;\r\n      transform: translateX(-20px);\r\n    }\r\n    to {\r\n      opacity: 1;\r\n      transform: translateX(0);\r\n    }\r\n  }\r\n\r\n  .file-info {\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 12px;\r\n    margin-bottom: 12px;\r\n  }\r\n\r\n  .file-icon {\r\n    width: 40px;\r\n    height: 40px;\r\n    background: var(--primary);\r\n    border-radius: 8px;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    color: white;\r\n    font-size: 20px;\r\n    flex-shrink: 0;\r\n  }\r\n\r\n  .file-details {\r\n    flex: 1;\r\n    min-width: 0;\r\n  }\r\n\r\n  .file-name {\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    color: var(--text);\r\n    white-space: nowrap;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n  }\r\n\r\n  .file-size {\r\n    font-size: 12px;\r\n    color: var(--text-secondary);\r\n    margin-top: 2px;\r\n  }\r\n\r\n  .file-actions {\r\n    display: flex;\r\n    gap: 8px;\r\n  }\r\n\r\n  .action-btn {\r\n    width: 32px;\r\n    height: 32px;\r\n    border: none;\r\n    border-radius: 6px;\r\n    cursor: pointer;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    transition: all 0.2s;\r\n    background: transparent;\r\n  }\r\n\r\n  .action-btn:hover {\r\n    background: var(--bg);\r\n  }\r\n\r\n  .remove-btn {\r\n    color: var(--error);\r\n  }\r\n\r\n  .progress-bar {\r\n    width: 100%;\r\n    height: 6px;\r\n    background: var(--bg);\r\n    border-radius: 3px;\r\n    overflow: hidden;\r\n    position: relative;\r\n  }\r\n\r\n  .progress-fill {\r\n    height: 100%;\r\n    background: linear-gradient(90deg, var(--primary), var(--primary-light));\r\n    border-radius: 3px;\r\n    transition: width 0.3s ease;\r\n    position: relative;\r\n    overflow: hidden;\r\n  }\r\n\r\n  .progress-fill::after {\r\n    content: '';\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);\r\n    animation: shimmer 1.5s infinite;\r\n  }\r\n\r\n  @keyframes shimmer {\r\n    0% { transform: translateX(-100%); }\r\n    100% { transform: translateX(100%); }\r\n  }\r\n\r\n  .progress-text {\r\n    font-size: 12px;\r\n    color: var(--text-secondary);\r\n    margin-top: 8px;\r\n    text-align: center;\r\n  }\r\n\r\n  .status-badge {\r\n    display: inline-flex;\r\n    align-items: center;\r\n    gap: 6px;\r\n    padding: 4px 12px;\r\n    border-radius: 12px;\r\n    font-size: 12px;\r\n    font-weight: 600;\r\n  }\r\n\r\n  .status-success {\r\n    background: rgba(16, 185, 129, 0.1);\r\n    color: var(--success);\r\n  }\r\n\r\n  .status-error {\r\n    background: rgba(239, 68, 68, 0.1);\r\n    color: var(--error);\r\n  }\r\n\r\n  .status-uploading {\r\n    background: rgba(99, 102, 241, 0.1);\r\n    color: var(--primary);\r\n  }\r\n\r\n  .error-message {\r\n    background: rgba(239, 68, 68, 0.1);\r\n    border: 1px solid var(--error);\r\n    color: var(--error);\r\n    padding: 12px 16px;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    margin-top: 16px;\r\n    display: flex;\r\n    align-items: center;\r\n    gap: 8px;\r\n  }\r\n\r\n  .constraints-info {\r\n    background: var(--bg-secondary);\r\n    border: 1px solid var(--border);\r\n    border-radius: 8px;\r\n    padding: 12px 16px;\r\n    margin-top: 16px;\r\n    font-size: 12px;\r\n    color: var(--text-secondary);\r\n  }\r\n\r\n  .constraints-info strong {\r\n    color: var(--text);\r\n  }\r\n\r\n  .widget-footer {\r\n    padding: 16px 24px;\r\n    border-top: 1px solid var(--border);\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    gap: 12px;\r\n  }\r\n\r\n  .footer-info {\r\n    font-size: 12px;\r\n    color: var(--text-secondary);\r\n  }\r\n\r\n  .footer-actions {\r\n    display: flex;\r\n    gap: 12px;\r\n  }\r\n\r\n  .btn-secondary {\r\n    background: var(--bg-secondary);\r\n    color: var(--text);\r\n    border: 1px solid var(--border);\r\n    padding: 10px 20px;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .btn-secondary:hover {\r\n    background: var(--bg);\r\n    border-color: var(--text-secondary);\r\n  }\r\n\r\n  .btn-primary {\r\n    background: var(--primary);\r\n    color: white;\r\n    border: none;\r\n    padding: 10px 20px;\r\n    border-radius: 8px;\r\n    font-size: 14px;\r\n    font-weight: 600;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  }\r\n\r\n  .btn-primary:hover {\r\n    background: var(--primary-dark);\r\n    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);\r\n  }\r\n\r\n  .btn-primary:disabled {\r\n    background: var(--border);\r\n    cursor: not-allowed;\r\n    box-shadow: none;\r\n  }\r\n\r\n  /* Scrollbar styles */\r\n  ::-webkit-scrollbar {\r\n    width: 8px;\r\n  }\r\n\r\n  ::-webkit-scrollbar-track {\r\n    background: var(--bg-secondary);\r\n    border-radius: 4px;\r\n  }\r\n\r\n  ::-webkit-scrollbar-thumb {\r\n    background: var(--border);\r\n    border-radius: 4px;\r\n  }\r\n\r\n  ::-webkit-scrollbar-thumb:hover {\r\n    background: var(--text-secondary);\r\n  }\r\n`;","import { WidgetCore } from './core/WidgetCore.js';\r\nimport { WidgetUI } from './ui/WidgetUI.js';\r\n\r\nclass ImaginaryWidget {\r\n  constructor() {\r\n    this.core = null;\r\n    this.ui = null;\r\n    this.isInitialized = false;\r\n  }\r\n\r\n  async init(options) {\r\n    if (this.isInitialized) {\r\n      console.warn('Widget is already initialized');\r\n      return this;\r\n    }\r\n\r\n    try {\r\n      // Create core instance\r\n      this.core = new WidgetCore(options);\r\n\r\n      // Initialize core (fetch constraints)\r\n      await this.core.initialize();\r\n\r\n      // Create UI instance\r\n      this.ui = new WidgetUI(this.core);\r\n\r\n      // Mount UI\r\n      this.ui.mount(options.mount || null);\r\n\r\n      this.isInitialized = true;\r\n\r\n      // Setup default event handlers if provided\r\n      if (options.onSuccess) {\r\n        this.core.on('upload:success', options.onSuccess);\r\n      }\r\n\r\n      if (options.onError) {\r\n        this.core.on('upload:error', options.onError);\r\n      }\r\n\r\n      if (options.onProgress) {\r\n        this.core.on('upload:progress', options.onProgress);\r\n      }\r\n\r\n      if (options.onComplete) {\r\n        this.core.on('upload:complete', options.onComplete);\r\n      }\r\n\r\n      console.log('‚úÖ ImaginaryWidget initialized successfully');\r\n      return this;\r\n\r\n    } catch (error) {\r\n      console.error('‚ùå Failed to initialize ImaginaryWidget:', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  open() {\r\n    if (!this.isInitialized) {\r\n      console.error('Widget is not initialized. Call init() first.');\r\n      return;\r\n    }\r\n    this.ui.open();\r\n  }\r\n\r\n  close() {\r\n    if (!this.isInitialized) {\r\n      return;\r\n    }\r\n    this.ui.close();\r\n  }\r\n\r\n  on(event, callback) {\r\n    if (!this.isInitialized) {\r\n      console.error('Widget is not initialized. Call init() first.');\r\n      return;\r\n    }\r\n    return this.core.on(event, callback);\r\n  }\r\n\r\n  off(event, callback) {\r\n    if (!this.isInitialized) {\r\n      return;\r\n    }\r\n    this.core.off(event, callback);\r\n  }\r\n\r\n  destroy() {\r\n    if (!this.isInitialized) {\r\n      return;\r\n    }\r\n\r\n    this.ui.destroy();\r\n    this.core.reset();\r\n    this.isInitialized = false;\r\n    console.log('üóëÔ∏è ImaginaryWidget destroyed');\r\n  }\r\n\r\n  getConstraints() {\r\n    if (!this.isInitialized) {\r\n      console.error('Widget is not initialized. Call init() first.');\r\n      return null;\r\n    }\r\n    return this.core.getConstraints();\r\n  }\r\n}\r\n\r\n// Export as global variable\r\nif (typeof window !== 'undefined') {\r\n  window.ImaginaryWidget = ImaginaryWidget;\r\n}\r\n\r\n// Export for module systems\r\nexport default ImaginaryWidget;"],"names":["EventEmitter","constructor","this","events","on","event","callback","push","off","filter","cb","emit","data","forEach","clear","Config","options","publicKey","apiUrl","maxFileSize","allowedMimeTypes","allowedDomains","requireCaptcha","fetchConstraints","response","fetch","ok","Error","json","error","console","validateFile","file","errors","size","formatBytes","length","includes","type","valid","bytes","i","Math","floor","log","round","pow","WidgetCore","super","config","isInitialized","currentToken","tokenExpiryTime","initialize","constraints","message","requestUploadToken","Date","now","token","async","method","headers","body","JSON","stringify","origin","window","location","uploadFile","onProgress","result","Promise","resolve","reject","formData","FormData","append","xhr","XMLHttpRequest","upload","addEventListener","e","lengthComputable","percentComplete","loaded","total","status","parse","responseText","transformedResponse","name","fileName","mimeType","url","fileUrl","fileId","open","send","getConstraints","reset","createFileItemTemplate","id","startsWith","k","sizes","WidgetUI","core","shadowRoot","container","isOpen","files","Map","fileIdCounter","mount","targetElement","host","document","createElement","attachShadow","mode","styleSheet","textContent","appendChild","template","innerHTML","firstElementChild","querySelector","setupEventListeners","displayConstraints","getElementById","close","target","browseBtn","fileInput","stopPropagation","click","handleFiles","Array","from","value","uploadArea","preventDefault","classList","add","remove","dataTransfer","clearAllFiles","uploadAllFiles","removeBtn","closest","parseInt","dataset","removeFile","validation","showError","join","set","progress","renderFileItem","updateUI","fileList","fileItemHTML","insertAdjacentHTML","delete","fileItem","style","animation","setTimeout","clearError","uploadAllBtn","disabled","fileData","entries","successful","values","f","failed","get","progressContainer","progressFill","progressText","statusContainer","display","width","fileCount","clearBtn","totalFiles","pendingFiles","constraintsInfo","html","limits","types","map","t","split","offsetHeight","overflow","destroy","ImaginaryWidget","ui","init","warn","onSuccess","onError","onComplete"],"mappings":"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"}